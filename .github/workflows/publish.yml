on:
  workflow_dispatch:

name: publish
jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@main
      - uses: astral-sh/setup-uv@main
        with:
          version: 'latest'
      - run: uv build
      - run: uv publish --token ${{secrets.PYPI_TOKEN}}
  poetry-util:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@main
      - uses: davidkhala/poetry-buildpack@main
        with:
          working-directory: .
      - run: poetry run build-poetry
        shell: bash
      - run: .\tests\poetry\test.ps1
      - uses: softprops/action-gh-release@master
        with:
          files: dist/poetry.exe
          tag_name: poetry-util